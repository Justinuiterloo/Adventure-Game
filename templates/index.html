<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adventure Game</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-black text-white flex items-center justify-center h-screen">
    <div class="flex flex-col items-center space-y-4">
      <div
        class="bg-gray-900 text-green-400 p-4 h-48 w-full border border-gray-600 mb-4 overflow-y-auto"
        id="output"
        style="width: 500px; height: 300px"
      ></div>

      <div class="flex flex-col space-y-2 w-96">
        <input
          class="bg-gray-800 border border-gray-600 rounded p-2 text-green-400"
          type="text"
          id="command"
          placeholder="Enter command"
        />
        <button
          class="bg-gray-700 text-white rounded px-4 py-2 hover:bg-gray-600"
          onclick="sendCommand()"
        >
          Submit
        </button>
      </div>
    </div>

    <script>
      const audioElement = document.getElementById("bg-music");
      audioElement.volume = 0.5; // Set volume (0.0 to 1.0)

      function playSound() {
        const audioContext = new (window.AudioContext ||
          window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        oscillator.type = "square"; // Square wave for a classic 8-bit sound
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // Frequency in Hz (440 is A4 pitch)

        // Optional: create a short envelope for the sound
        const gainNode = audioContext.createGain();
        gainNode.gain.setValueAtTime(1, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(
          0,
          audioContext.currentTime + 0.05
        ); // Fade out

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.05); // Duration in seconds
      }

      document.addEventListener("DOMContentLoaded", () => {
        fetch("/start")
          .then((response) => response.json())
          .then((data) => {
            typeText("> " + data.description);
            playSound();
          });
      });

      function typeText(text) {
        let i = 0;
        const output = document.getElementById("output");

        function type() {
          if (i < text.length) {
            if (text[i] === "\n") {
              output.innerHTML += "<br>";
            } else {
              output.innerHTML += text[i];
              playSound();
            }
            i++;
            setTimeout(type, 25);
            output.scrollTop = output.scrollHeight;
          }
        }

        type();
      }

      function sendCommand() {
        const command = document.getElementById("command").value;

        fetch("/command", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ command: command }),
        })
          .then((response) => response.json())
          .then((data) => {
            typeText("\n> You said: " + command + "!\n> " + data.response);
            document.getElementById("command").value = "";
          });
      }
    </script>
  </body>
</html>
